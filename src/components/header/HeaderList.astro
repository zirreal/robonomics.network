---
import { getLocale } from "astro-i18n-aut";

const locale = getLocale(Astro.url) || 'en';
const {classList = ''} = Astro.props;

const generatePath = (path) => (locale === 'en' ? path : `/${locale}${path}`);

const normalizePath = (p) => {
  if (!p) return '/';
  // remove trailing slashes (except root)
  let out = p.length > 1 ? p.replace(/\/+$/, '') : p;
  // remove locale prefix (treat /en as root too)
  if (locale !== 'en' && out.startsWith(`/${locale}`)) {
    out = out.slice(locale.length + 1) || '/';
  } else if (out.startsWith('/en/')) {
    out = out.slice(3) || '/';
  } else if (out === '/en') {
    out = '/';
  }
  return out || '/';
};

const currentPath = normalizePath(Astro.url.pathname);
const isActive = (target) => {
  const t = normalizePath(target);
  if (t === '/') return currentPath === '/';
  return currentPath === t || currentPath.startsWith(`${t}/`);
};
---

<nav class={'header-nav ' + classList} aria-label="Primary">
  <a href={generatePath('/devices/')} class:list={["header-link", isActive('/devices') && "is-active"]}>{$tr('SHOP DEVICES')}</a>
  <a href={generatePath('/ecosystem/')} class:list={["header-link", isActive('/ecosystem') && "is-active"]}>{$tr('ECOSYSTEM')}</a>
  <a href={generatePath('/')} class:list={["header-link", "header-link--home", isActive('/') && "is-active"]} aria-label={$tr('HOME')}>{$tr('HOME')}</a>
  <a href={generatePath('/community/')} class:list={["header-link", isActive('/community') && "is-active"]}>{$tr('COMMUNITY')}</a>
  <a href={generatePath('/contact/')} class:list={["header-link", "header-link--ask", isActive('/contact') && "is-active"]}>{$tr('ASK A TECHNICIAN')}</a>
</nav>

<style>

  .header-nav {
    width: 100%;
    padding-left: 1.85rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: calc(var(--space) * 1.2);
    text-transform: uppercase;
    font-size: calc(var(--base-font-size) * 0.7);
    font-variation-settings: var(--font-flex-extrabold);
    position: relative;
    transform: scale(1);
    transform-origin: center;
    transition: transform 0.25s ease-out;
    will-change: transform;
    contain: layout style;
  }
  
  :global(.header.is-scrolled) :global(.header-nav) {
    transform: scale(0.9);
  }

  .header-link--home {
    position: relative;
  }

  .header-link:hover {
    opacity: 0.85;
  }

  .header-link.is-active {
    color: #000;
  }

  .header-link--ask {
    color: #e6004c;
    transition: color 0.33s ease-in-out;
  }

  @media screen and (max-width: 900px) {
    .header-nav {
      font-size: 0.8rem;
    }
  }

  @media screen and (max-width: 580px) {
    .header-nav {
      padding-bottom: calc(var(--space) * 2);
      flex-direction: column;
      gap: calc(var(--space) * 0.7);
      font-size: var(--base-font-size);
      width: 100%;
    }
  }

</style>